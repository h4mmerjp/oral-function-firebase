<!-- contact.html - GitHub Issue連携版 -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>お問い合わせ - 口腔機能低下症診断・管理アプリ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>お問い合わせ</h1>
      <p><a href="index.html">← アプリに戻る</a></p>
    </header>

    <div class="summary-card">
      <h2>お問い合わせ</h2>
      
      <p>口腔機能低下症診断・管理アプリに関するご質問・ご要望・不具合報告等がございましたら、以下のフォームからお気軽にお問い合わせください。</p>

      <div class="info-box" style="background: #e3f2fd; border: 1px solid #2196f3; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <h4>📋 透明性の高いサポート</h4>
        <p>お問い合わせ内容はGitHubのIssueとして公開され、開発の透明性を保ちます。同様の問題を抱える他のユーザーにも役立ちます。</p>
        <p><strong>個人情報や患者情報は入力しないでください。</strong></p>
      </div>

      <h3>📝 お問い合わせフォーム</h3>
      <div style="background: #f8f9fa; padding: 20px; border-radius: 4px; margin: 20px 0;">
        <form id="contact-form">
          <div class="form-group">
            <label for="contact-name">お名前（ニックネーム可） *</label>
            <input type="text" id="contact-name" required placeholder="例：田中先生、歯科医師A、など">
            <small style="color: #666;">※ GitHubで公開されます。ニックネームでも構いません。</small>
          </div>
          
          <div class="form-group">
            <label for="contact-email">メールアドレス（任意）</label>
            <input type="email" id="contact-email" placeholder="返信が必要な場合のみご入力ください">
            <small style="color: #666;">※ 入力した場合、GitHub Issue内で公開されます。</small>
          </div>
          
          <div class="form-group">
            <label for="contact-category">お問い合わせ種別 *</label>
            <select id="contact-category" required>
              <option value="">選択してください</option>
              <option value="bug">🐛 不具合報告</option>
              <option value="feature">✨ 機能要望</option>
              <option value="question">❓ 使い方について</option>
              <option value="account">🔐 アカウント・ログイン</option>
              <option value="performance">⚡ パフォーマンス・速度</option>
              <option value="ui">🎨 UI・デザイン</option>
              <option value="compatibility">📱 ブラウザ・デバイス対応</option>
              <option value="documentation">📚 ドキュメント・ヘルプ</option>
              <option value="other">🔧 その他</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="contact-title">タイトル *</label>
            <input type="text" id="contact-title" required placeholder="例：検査結果が保存されない、患者登録でエラーが発生する、など">
            <small style="color: #666;">※ 問題や要望を簡潔に表現してください。</small>
          </div>
          
          <div class="form-group">
            <label for="contact-message">詳細内容 *</label>
            <textarea id="contact-message" rows="8" required placeholder="具体的な状況や手順をご記入ください。

【推奨記載内容】
- 発生状況（いつ、どこで、何をした時に）
- 使用環境（ブラウザ、OS、デバイス）
- エラーメッセージ（あれば）
- 期待する動作"></textarea>
          </div>
          
          <div class="form-group">
            <label for="contact-browser">使用環境（任意）</label>
            <input type="text" id="contact-browser" placeholder="例：Chrome 120, Windows 11, iPhone Safari など">
          </div>

          <!-- プライバシー確認 -->
          <div class="form-group">
            <label class="checkbox-item">
              <input type="checkbox" id="privacy-agreement" required>
              <span>個人情報や患者情報を含まないことを確認しました</span>
            </label>
          </div>

          <div class="form-group">
            <label class="checkbox-item">
              <input type="checkbox" id="public-agreement" required>
              <span>内容がGitHub Issueとして公開されることに同意します</span>
            </label>
          </div>
          
          <div class="form-group">
            <button type="button" onclick="submitToGitHub()" class="btn-success">GitHubに送信</button>
            <button type="button" onclick="resetForm()" class="btn-secondary">リセット</button>
          </div>

          <!-- 送信状態表示 -->
          <div id="submission-status" style="display: none; margin-top: 15px;"></div>
        </form>
      </div>

      <h3>🔍 既存の問題・要望を確認</h3>
      <p>同様の問題が既に報告されている可能性があります。まず以下をご確認ください：</p>
      <div style="text-align: center; margin: 20px 0;">
        <a href="https://github.com/h4mmerjp/oral-function-firebase/issues" target="_blank" class="btn-secondary">
          📋 GitHub Issues を確認する
        </a>
      </div>

      <h3>❓ よくあるご質問</h3>
      
      <details style="margin: 10px 0;">
        <summary style="cursor: pointer; font-weight: bold;">Q: ログインできません</summary>
        <p>A: Googleアカウントでのログインが必要です。ブラウザのCookieが有効になっていることを確認してください。ポップアップブロッカーの設定もご確認ください。</p>
      </details>
      
      <details style="margin: 10px 0;">
        <summary style="cursor: pointer; font-weight: bold;">Q: 患者データが消えました</summary>
        <p>A: ログインしていない状態ではデータが保存されません。必ずGoogleアカウントでログインしてご利用ください。オフライン時のデータは一時的なものです。</p>
      </details>
      
      <details style="margin: 10px 0;">
        <summary style="cursor: pointer; font-weight: bold;">Q: 5人以上の患者を登録したい</summary>
        <p>A: 無料プランは5人までの制限があります。プレミアムプランで無制限に登録できます（現在準備中）。</p>
      </details>
      
      <details style="margin: 10px 0;">
        <summary style="cursor: pointer; font-weight: bold;">Q: 診断結果の信頼性について</summary>
        <p>A: 本アプリは診断補助ツールです。最終的な診断や治療方針の決定は、必ず医療従事者の判断により行ってください。</p>
      </details>

      <details style="margin: 10px 0;">
        <summary style="cursor: pointer; font-weight: bold;">Q: スマートフォンで正常に動作しない</summary>
        <p>A: 最新のブラウザ（Chrome、Safari）をご利用ください。画面サイズの関係で、タブレット以上の画面サイズを推奨しています。</p>
      </details>

      <h3>🛡️ プライバシーについて</h3>
      <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <p><strong>⚠️ 重要な注意事項</strong></p>
        <ul>
          <li>患者の個人情報（氏名、連絡先等）は絶対に入力しないでください</li>
          <li>医療情報や診断内容に関する具体的なデータは含めないでください</li>
          <li>お問い合わせ内容はGitHubで公開され、検索エンジンでも表示される可能性があります</li>
          <li>緊急性の高い医療的な問題については、直接医療機関にご相談ください</li>
        </ul>
      </div>

      <h3>📈 開発ロードマップ</h3>
      <p>今後の開発予定や機能追加については、以下でご確認いただけます：</p>
      <div style="text-align: center; margin: 20px 0;">
        <a href="https://github.com/h4mmerjp/oral-function-firebase/projects" target="_blank" class="btn-secondary">
          🗺️ 開発ロードマップを見る
        </a>
      </div>
    </div>
  </div>

  <script>
    // GitHub Issue作成API呼び出し
    async function submitToGitHub() {
      // バリデーション
      if (!validateForm()) return;

      const submitButton = document.querySelector('button[onclick="submitToGitHub()"]');
      const statusDiv = document.getElementById('submission-status');
      
      // 送信状態表示
      submitButton.disabled = true;
      submitButton.textContent = '送信中...';
      statusDiv.style.display = 'block';
      statusDiv.innerHTML = '<div style="color: #2196f3;">📤 GitHub Issueを作成中...</div>';

      try {
        const formData = collectFormData();
        const issueBody = formatIssueBody(formData);
        
        // GitHub Issues URLを生成（新しいIssue作成画面）
        const repoUrl = 'https://github.com/h4mmerjp/oral-function-firebase';
        const issueUrl = `${repoUrl}/issues/new?` + new URLSearchParams({
          title: formData.title,
          body: issueBody,
          labels: getCategoryLabel(formData.category)
        });

        // 新しいタブでGitHub Issue作成画面を開く
        window.open(issueUrl, '_blank');
        
        // 成功メッセージ
        statusDiv.innerHTML = `
          <div style="color: #4caf50; background: #e8f5e8; padding: 15px; border-radius: 4px;">
            <h4>✅ 送信準備完了</h4>
            <p>GitHub Issueの作成画面が開きました。内容を確認して「Submit new issue」ボタンを押してください。</p>
            <p><a href="${repoUrl}/issues" target="_blank">📋 Issue一覧を見る</a></p>
          </div>
        `;
        
        // フォームをリセット
        setTimeout(() => {
          resetForm();
        }, 3000);

      } catch (error) {
        console.error('Issue作成エラー:', error);
        statusDiv.innerHTML = `
          <div style="color: #f44336; background: #ffebee; padding: 15px; border-radius: 4px;">
            <h4>❌ 送信に失敗しました</h4>
            <p>お手数ですが、<a href="https://github.com/h4mmerjp/oral-function-firebase/issues/new" target="_blank">GitHub Issues</a>から直接ご報告ください。</p>
          </div>
        `;
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = 'GitHubに送信';
      }
    }

    function validateForm() {
      const name = document.getElementById('contact-name').value.trim();
      const category = document.getElementById('contact-category').value;
      const title = document.getElementById('contact-title').value.trim();
      const message = document.getElementById('contact-message').value.trim();
      const privacyAgreed = document.getElementById('privacy-agreement').checked;
      const publicAgreed = document.getElementById('public-agreement').checked;

      if (!name || !category || !title || !message) {
        alert('必須項目をすべて入力してください。');
        return false;
      }

      if (!privacyAgreed || !publicAgreed) {
        alert('プライバシーと公開に関する確認事項にチェックを入れてください。');
        return false;
      }

      return true;
    }

    function collectFormData() {
      return {
        name: document.getElementById('contact-name').value.trim(),
        email: document.getElementById('contact-email').value.trim(),
        category: document.getElementById('contact-category').value,
        title: document.getElementById('contact-title').value.trim(),
        message: document.getElementById('contact-message').value.trim(),
        browser: document.getElementById('contact-browser').value.trim()
      };
    }

    function formatIssueBody(data) {
      let body = `## 報告者情報\n`;
      body += `**名前:** ${data.name}\n`;
      if (data.email) {
        body += `**連絡先:** ${data.email}\n`;
      }
      body += `**カテゴリー:** ${getCategoryText(data.category)}\n\n`;

      body += `## 詳細内容\n`;
      body += `${data.message}\n\n`;

      if (data.browser) {
        body += `## 使用環境\n`;
        body += `${data.browser}\n\n`;
      }

      body += `## 補足情報\n`;
      body += `- 報告日: ${new Date().toLocaleDateString('ja-JP')}\n`;
      body += `- 送信元: お問い合わせフォーム\n`;
      body += `- アプリバージョン: 2.0\n\n`;

      body += `---\n`;
      body += `このIssueは[お問い合わせフォーム](https://oral-function-firebase.vercel.app/contact.html)から自動生成されました。`;

      return body;
    }

    function getCategoryLabel(category) {
      const labels = {
        'bug': 'bug',
        'feature': 'enhancement',
        'question': 'question',
        'account': 'authentication',
        'performance': 'performance',
        'ui': 'ui/ux',
        'compatibility': 'compatibility',
        'documentation': 'documentation',
        'other': 'general'
      };
      return labels[category] || 'general';
    }

    function getCategoryText(category) {
      const texts = {
        'bug': '🐛 不具合報告',
        'feature': '✨ 機能要望',
        'question': '❓ 使い方について',
        'account': '🔐 アカウント・ログイン',
        'performance': '⚡ パフォーマンス・速度',
        'ui': '🎨 UI・デザイン',
        'compatibility': '📱 ブラウザ・デバイス対応',
        'documentation': '📚 ドキュメント・ヘルプ',
        'other': '🔧 その他'
      };
      return texts[category] || '🔧 その他';
    }

    function resetForm() {
      document.getElementById('contact-form').reset();
      document.getElementById('submission-status').style.display = 'none';
    }

    // フォーム入力時のリアルタイムバリデーション
    document.getElementById('contact-message').addEventListener('input', function() {
      const message = this.value.toLowerCase();
      const warningDiv = document.getElementById('privacy-warning') || (() => {
        const div = document.createElement('div');
        div.id = 'privacy-warning';
        div.style.display = 'none';
        this.parentNode.appendChild(div);
        return div;
      })();

      // 個人情報らしきキーワードを検出
      const sensitiveKeywords = ['患者', '田中', '佐藤', '鈴木', '高橋', '電話', 'tel', 'phone', '@', 'gmail', 'yahoo'];
      const foundKeywords = sensitiveKeywords.filter(keyword => message.includes(keyword));

      if (foundKeywords.length > 0) {
        warningDiv.style.display = 'block';
        warningDiv.innerHTML = `
          <div style="color: #f44336; background: #ffebee; padding: 10px; border-radius: 4px; margin-top: 10px;">
            ⚠️ 個人情報や患者情報が含まれている可能性があります。公開されても問題ない内容かご確認ください。
          </div>
        `;
      } else {
        warningDiv.style.display = 'none';
      }
    });
  </script>

  <style>
    .info-box {
      margin: 20px 0;
    }

    .info-box h4 {
      margin: 0 0 10px 0;
      color: #1976d2;
    }

    details {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
    }

    details summary {
      font-weight: bold;
      padding: 5px 0;
      outline: none;
    }

    details[open] summary {
      border-bottom: 1px solid #ddd;
      margin-bottom: 10px;
      padding-bottom: 10px;
    }

    .checkbox-item {
      display: flex;
      align-items: flex-start;
      margin: 10px 0;
    }

    .checkbox-item input[type="checkbox"] {
      margin-right: 10px;
      margin-top: 2px;
      width: auto;
    }

    .checkbox-item span {
      flex: 1;
    }

    small {
      display: block;
      margin-top: 5px;
      font-size: 12px;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</body>
</html>
