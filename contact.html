<!-- contact.html - GitHub Issueé€£æºç‰ˆ -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãŠå•ã„åˆã‚ã› - å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="styles.css">
  <script src="security.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>ãŠå•ã„åˆã‚ã›</h1>
      <p><a href="index.html">â† ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a></p>
    </header>

    <div class="summary-card">
      <h2>ãŠå•ã„åˆã‚ã›</h2>
      
      <p>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒªã«é–¢ã™ã‚‹ã”è³ªå•ãƒ»ã”è¦æœ›ãƒ»ä¸å…·åˆå ±å‘Šç­‰ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>

      <div class="info-box" style="background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <h4>ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ</h4>
        <p>ãŠå•ã„åˆã‚ã›ã¯æŠ€è¡“ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ãŒå†…éƒ¨ã§ç®¡ç†ã—ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¿è­·ã—ã¾ã™ã€‚</p>
        <p><strong>24æ™‚é–“ä»¥å†…ã«è‡ªå‹•å¿œç­”ã‚·ã‚¹ãƒ†ãƒ ãŒãŠç­”ãˆã—ã¾ã™ã€‚</strong></p>
      </div>

      <h3>ğŸ“ ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ </h3>
      <div style="background: #f8f9fa; padding: 20px; border-radius: 4px; margin: 20px 0;">
        <form id="contact-form">
          <div class="form-group">
            <label for="contact-name">ãŠåå‰ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å¯ï¼‰ *</label>
            <input type="text" id="contact-name" required placeholder="ä¾‹ï¼šç”°ä¸­å…ˆç”Ÿã€æ­¯ç§‘åŒ»å¸«Aã€ãªã©">
            <small style="color: #666;">â€» æŠ€è¡“ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ å†…ã§ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</small>
          </div>
          
          <div class="form-group">
            <label for="contact-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä»»æ„ï¼‰</label>
            <input type="email" id="contact-email" placeholder="è¿”ä¿¡ãŒå¿…è¦ãªå ´åˆã®ã¿ã”å…¥åŠ›ãã ã•ã„">
            <small style="color: #666;">â€» è¿½åŠ æƒ…å ±ãŒå¿…è¦ãªå ´åˆã®é€£çµ¡å…ˆã§ã™ã€‚å®‰å…¨ã«ä¿è­·ã•ã‚Œã¾ã™ã€‚</small>
          </div>
          
          <div class="form-group">
            <label for="contact-category">ãŠå•ã„åˆã‚ã›ç¨®åˆ¥ *</label>
            <select id="contact-category" required>
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="bug">ä¸å…·åˆå ±å‘Š</option>
              <option value="feature">æ©Ÿèƒ½è¦æœ›</option>
              <option value="question">ä½¿ã„æ–¹ã«ã¤ã„ã¦</option>
              <option value="account">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³</option>
              <option value="performance">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»é€Ÿåº¦</option>
              <option value="ui">UIãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³</option>
              <option value="compatibility">ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ</option>
              <option value="documentation">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ˜ãƒ«ãƒ—</option>
              <option value="security">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</option>
              <option value="other">ãã®ä»–</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="contact-title">ã‚¿ã‚¤ãƒˆãƒ« *</label>
            <input type="text" id="contact-title" required placeholder="ä¾‹ï¼šæ¤œæŸ»çµæœãŒä¿å­˜ã•ã‚Œãªã„ã€æ‚£è€…ç™»éŒ²ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€ãªã©">
            <small style="color: #666;">â€» å•é¡Œã‚„è¦æœ›ã‚’ç°¡æ½”ã«è¡¨ç¾ã—ã¦ãã ã•ã„ã€‚</small>
          </div>
          
          <div class="form-group">
            <label for="contact-message">è©³ç´°å†…å®¹ *</label>
            <textarea id="contact-message" rows="8" required placeholder="å…·ä½“çš„ãªçŠ¶æ³ã‚„æ‰‹é †ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚

ã€æ¨å¥¨è¨˜è¼‰å†…å®¹ã€‘
- ç™ºç”ŸçŠ¶æ³ï¼ˆã„ã¤ã€ã©ã“ã§ã€ä½•ã‚’ã—ãŸæ™‚ã«ï¼‰
- ä½¿ç”¨ç’°å¢ƒï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã€OSã€ãƒ‡ãƒã‚¤ã‚¹ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚ã‚Œã°ï¼‰
- æœŸå¾…ã™ã‚‹å‹•ä½œ"></textarea>
          </div>
          
          <div class="form-group">
            <label for="contact-browser">ä½¿ç”¨ç’°å¢ƒï¼ˆä»»æ„ï¼‰</label>
            <input type="text" id="contact-browser" placeholder="ä¾‹ï¼šChrome 120, Windows 11, iPhone Safari ãªã©">
          </div>

          <!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ç¢ºèª -->
          <div class="form-group">
            <label class="checkbox-item">
              <input type="checkbox" id="privacy-agreement" required>
              <span>å€‹äººæƒ…å ±ã‚„æ‚£è€…æƒ…å ±ã‚’å«ã¾ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸ</span>
            </label>
          </div>

          <div class="form-group">
            <label class="checkbox-item">
              <input type="checkbox" id="terms-agreement" required>
              <span>ãŠå•ã„åˆã‚ã›å†…å®¹ã®å‡¦ç†ã¨æŠ€è¡“ã‚µãƒãƒ¼ãƒˆã§ã®ä½¿ç”¨ã«åŒæ„ã—ã¾ã™</span>
            </label>
          </div>
          
          <div class="form-group">
            <button type="button" onclick="submitContact()" class="btn-success">ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡</button>
            <button type="button" onclick="resetForm()" class="btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>

          <!-- é€ä¿¡çŠ¶æ…‹è¡¨ç¤º -->
          <div id="submission-status" style="display: none; margin-top: 15px;"></div>
        </form>
      </div>


      <h3>â“ ã‚ˆãã‚ã‚‹ã”è³ªå•</h3>

      <!-- FAQ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯JavaScriptã§å‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ -->
      <div id="faq-content" style="margin: 20px 0;">
        ğŸ“„ ã‚ˆãã‚ã‚‹è³ªå•ã‚’èª­ã¿è¾¼ã¿ä¸­...
      </div>

      <div style="margin: 20px 0; text-align: center;">
        <a href="faq.html" style="display: inline-block; background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">ã™ã¹ã¦ã®è³ªå•ã‚’è¦‹ã‚‹</a>
      </div>

      <h3>ğŸ›¡ï¸ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã«ã¤ã„ã¦</h3>
      <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <p><strong>âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …</strong></p>
        <ul>
          <li>æ‚£è€…ã®å€‹äººæƒ…å ±ï¼ˆæ°åã€é€£çµ¡å…ˆç­‰ï¼‰ã¯çµ¶å¯¾ã«å…¥åŠ›ã—ãªã„ã§ãã ã•ã„</li>
          <li>åŒ»ç™‚æƒ…å ±ã‚„è¨ºæ–­å†…å®¹ã«é–¢ã™ã‚‹å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿ã¯å«ã‚ãªã„ã§ãã ã•ã„</li>
          <li>ç·Šæ€¥æ€§ã®é«˜ã„åŒ»ç™‚çš„ãªå•é¡Œã«ã¤ã„ã¦ã¯ã€ç›´æ¥åŒ»ç™‚æ©Ÿé–¢ã«ã”ç›¸è«‡ãã ã•ã„</li>
        </ul>
      </div>

  <script>
    // faq.htmlã‹ã‚‰ã‚ˆãã‚ã‚‹è³ªå•ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€é–¢æ•°
    async function loadFAQFromExternal() {
      try {
        const response = await fetch('faq.html');
        const text = await response.text();

        // HTMLãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ä½œæˆ
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');

        // ã‚ˆãã‚ã‚‹è³ªå•ã®detailsè¦ç´ ã‚’å–å¾—
        const faqDetails = doc.querySelectorAll('details');
        const faqContentDiv = document.getElementById('faq-content');

        if (faqDetails.length > 0 && faqContentDiv) {
          // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¯ãƒªã‚¢
          faqContentDiv.innerHTML = '';

          // faq.htmlã‹ã‚‰detailsè¦ç´ ã‚’ã‚³ãƒ”ãƒ¼
          faqDetails.forEach(detail => {
            if (detail.querySelector('summary')) {
              const clonedDetail = detail.cloneNode(true);
              // contact.htmlç”¨ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
              clonedDetail.style.cssText = 'margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; padding: 10px;';
              const summary = clonedDetail.querySelector('summary');
              if (summary) {
                summary.style.cssText = 'cursor: pointer; font-weight: bold; padding: 5px 0; outline: none;';
              }
              const content = clonedDetail.querySelector('p');
              if (content) {
                content.style.cssText = 'margin: 0; font-size: 0.9rem; color: #555;';
                content.parentElement.style.cssText = 'border-top: 1px solid #ddd; margin-top: 10px; padding-top: 10px;';
              }

              faqContentDiv.appendChild(clonedDetail);
            }
          });

          console.log('ã‚ˆãã‚ã‚‹è³ªå•ã‚’å‹•çš„ã«æ›´æ–°ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.log('ã‚ˆãã‚ã‚‹è³ªå•ã®å‹•çš„èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        // å¤±æ•—æ™‚ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        const faqContentDiv = document.getElementById('faq-content');
        if (faqContentDiv) {
          faqContentDiv.innerHTML = '<p style="color: #999; font-size: 0.9rem;">ã‚ˆãã‚ã‚‹è³ªå•ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<a href="faq.html">ã“ã¡ã‚‰</a>ã‹ã‚‰ã”è¦§ãã ã•ã„ã€‚</p>';
        }
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«FAQã‚’èª­ã¿è¾¼ã¿
    document.addEventListener('DOMContentLoaded', function() {
      loadFAQFromExternal();
    });

    // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãŠå•ã„åˆã‚ã›APIå‘¼ã³å‡ºã—
    async function submitContact() {
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!validateForm()) return;
      
      // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!validateSensitiveData()) return;

      const submitButton = document.querySelector('button[onclick="submitContact()"]');
      const statusDiv = document.getElementById('submission-status');
      
      // é€ä¿¡çŠ¶æ…‹è¡¨ç¤º
      submitButton.disabled = true;
      submitButton.textContent = 'é€ä¿¡ä¸­...';
      statusDiv.style.display = 'block';
      statusDiv.innerHTML = '<div style="color: #2196f3;">ğŸ“¤ ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡ä¸­...</div>';

      try {
        const formData = collectFormData();
        
        // å†…éƒ¨APIã«é€ä¿¡ï¼ˆVercelç’°å¢ƒå¯¾å¿œï¼‰
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok) {
          // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          statusDiv.innerHTML = `
            <div style="color: #4caf50; background: #e8f5e8; padding: 15px; border-radius: 4px;">
              <h4>âœ… é€ä¿¡å®Œäº†</h4>
              <p>${result.message}</p>
              <div style="margin: 10px 0; padding: 10px; background: #f0f7ff; border-radius: 4px;">
                <strong>ğŸ“‹ å—ä»˜è©³ç´°:</strong><br>
                <small>
                  â€¢ æŠ•ç¨¿ID: <code>${result.details.submissionId}</code><br>
                  â€¢ ã‚«ãƒ†ã‚´ãƒªãƒ¼: ${result.details.category}<br>
                  â€¢ äºˆæƒ³å¿œç­”æ™‚é–“: ${result.details.estimatedResponseTime}
                </small>
              </div>
              <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong></p>
              <ul style="margin: 5px 0; padding-left: 20px;">
                ${result.details.nextSteps.map(step => `<li>${step}</li>`).join('')}
              </ul>
            </div>
          `;
          
          // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
          setTimeout(() => {
            resetForm();
          }, 5000);

        } else {
          throw new Error(result.message || 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }

      } catch (error) {
        console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
        statusDiv.innerHTML = `
          <div style="color: #f44336; background: #ffebee; padding: 15px; border-radius: 4px;">
            <h4>âŒ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ</h4>
            <p>${error.message}</p>
            <p>ãŠæ‰‹æ•°ã§ã™ãŒã€ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>
            <p>å•é¡ŒãŒç¶šãå ´åˆã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã”ç¢ºèªã„ãŸã ãã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚</p>
          </div>
        `;
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = 'ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡';
      }
    }

    function validateForm() {
      const name = document.getElementById('contact-name').value.trim();
      const category = document.getElementById('contact-category').value;
      const title = document.getElementById('contact-title').value.trim();
      const message = document.getElementById('contact-message').value.trim();
      const privacyAgreed = document.getElementById('privacy-agreement').checked;
      const termsAgreed = document.getElementById('terms-agreement').checked;

      if (!name || !category || !title || !message) {
        alert('å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return false;
      }

      if (!privacyAgreed || !termsAgreed) {
        alert('ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨åˆ©ç”¨è¦ç´„ã®ç¢ºèªäº‹é …ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚');
        return false;
      }

      return true;
    }

    function collectFormData() {
      return {
        name: document.getElementById('contact-name').value.trim(),
        email: document.getElementById('contact-email').value.trim(),
        category: document.getElementById('contact-category').value,
        title: document.getElementById('contact-title').value.trim(),
        message: document.getElementById('contact-message').value.trim(),
        browser: document.getElementById('contact-browser').value.trim()
      };
    }

    function formatIssueBody(data) {
      let body = `## å ±å‘Šè€…æƒ…å ±\n`;
      body += `**åå‰:** ${data.name}\n`;
      if (data.email) {
        body += `**é€£çµ¡å…ˆ:** ${data.email}\n`;
      }
      body += `**ã‚«ãƒ†ã‚´ãƒªãƒ¼:** ${getCategoryText(data.category)}\n\n`;

      body += `## è©³ç´°å†…å®¹\n`;
      body += `${data.message}\n\n`;

      if (data.browser) {
        body += `## ä½¿ç”¨ç’°å¢ƒ\n`;
        body += `${data.browser}\n\n`;
      }

      body += `## è£œè¶³æƒ…å ±\n`;
      body += `- å ±å‘Šæ—¥: ${new Date().toLocaleDateString('ja-JP')}\n`;
      body += `- é€ä¿¡å…ƒ: ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ \n`;
      body += `- ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³: 2.0\n\n`;

      body += `---\n`;
      body += `ã“ã®Issueã¯[ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ](https://oral-function-firebase.vercel.app/contact.html)ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚`;

      return body;
    }

    function getCategoryLabel(category) {
      const labels = {
        'bug': 'bug',
        'feature': 'enhancement',
        'question': 'question',
        'account': 'authentication',
        'performance': 'performance',
        'ui': 'ui/ux',
        'compatibility': 'compatibility',
        'documentation': 'documentation',
        'other': 'general'
      };
      return labels[category] || 'general';
    }

    function getCategoryText(category) {
      const texts = {
        'bug': 'ğŸ› ä¸å…·åˆå ±å‘Š',
        'feature': 'âœ¨ æ©Ÿèƒ½è¦æœ›',
        'question': 'â“ ä½¿ã„æ–¹ã«ã¤ã„ã¦',
        'account': 'ğŸ” ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³',
        'performance': 'âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»é€Ÿåº¦',
        'ui': 'ğŸ¨ UIãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³',
        'compatibility': 'ğŸ“± ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ',
        'documentation': 'ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ˜ãƒ«ãƒ—',
        'other': 'ğŸ”§ ãã®ä»–'
      };
      return texts[category] || 'ğŸ”§ ãã®ä»–';
    }

    function resetForm() {
      document.getElementById('contact-form').reset();
      document.getElementById('submission-status').style.display = 'none';
    }

    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ï¼ˆå­˜åœ¨ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
    function loadSecurityValidation() {
      if (typeof window.securityUtils === 'undefined') {
        // security.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã®åŸºæœ¬ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        console.log('security.js not loaded, using basic validation');
        return {
          detectSensitiveData: function(content) {
            const basicPatterns = [
              /\d{3}-?\d{4}-?\d{4}/g, // é›»è©±ç•ªå·
              /[^\s]+@[^\s]+\.[^\s]+/g, // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
              /(ç”°ä¸­|ä½è—¤|éˆ´æœ¨|é«˜æ©‹|å±±ç”°|æ‚£è€…)/g // åŸºæœ¬çš„ãªå€‹äººæƒ…å ±ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
            ];
            
            let hasRisk = false;
            for (const pattern of basicPatterns) {
              if (pattern.test(content)) {
                hasRisk = true;
                break;
              }
            }
            
            return {
              hasSensitiveData: hasRisk,
              riskLevel: hasRisk ? 'medium' : 'safe',
              detectedItems: []
            };
          }
        };
      }
      return window.securityUtils;
    }

    // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›æ™‚ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ç‰ˆï¼‰
    document.getElementById('contact-message').addEventListener('input', function() {
      const message = this.value;
      const warningDiv = document.getElementById('privacy-warning') || (() => {
        const div = document.createElement('div');
        div.id = 'privacy-warning';
        div.style.display = 'none';
        this.parentNode.appendChild(div);
        return div;
      })();

      // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦æ©Ÿå¯†æƒ…å ±ã‚’æ¤œå‡º
      const securityUtils = loadSecurityValidation();
      const sensitiveCheck = securityUtils.detectSensitiveData(message);

      if (sensitiveCheck.hasSensitiveData) {
        const riskColor = sensitiveCheck.riskLevel === 'high' ? '#d32f2f' : 
                         sensitiveCheck.riskLevel === 'medium' ? '#f57c00' : '#1976d2';
        
        let detailsHtml = '';
        if (sensitiveCheck.detectedItems && sensitiveCheck.detectedItems.length > 0) {
          detailsHtml = '<ul style="margin: 5px 0; padding-left: 20px;">';
          sensitiveCheck.detectedItems.forEach(item => {
            detailsHtml += `<li>${item.type}: ${item.count}ä»¶</li>`;
          });
          detailsHtml += '</ul>';
        }
        
        warningDiv.style.display = 'block';
        warningDiv.innerHTML = `
          <div style="color: ${riskColor}; background: ${riskColor}10; border: 1px solid ${riskColor}; padding: 10px; border-radius: 4px; margin-top: 10px;">
            âš ï¸ <strong>å€‹äººæƒ…å ±ã‚„æ©Ÿå¯†æƒ…å ±ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ</strong><br>
            ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: ${sensitiveCheck.riskLevel === 'high' ? 'é«˜' : sensitiveCheck.riskLevel === 'medium' ? 'ä¸­' : 'ä½'}
            ${detailsHtml}
            <small style="display: block; margin-top: 5px;">
              GitHub Issueã¯å…¬é–‹ã•ã‚Œã¾ã™ã€‚å€‹äººã‚’ç‰¹å®šã§ãã‚‹æƒ…å ±ã¯å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚
            </small>
          </div>
        `;
      } else {
        warningDiv.style.display = 'none';
      }
    });

    // é€ä¿¡å‰ã®æœ€çµ‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateSensitiveData() {
      const formData = collectFormData();
      const allContent = Object.values(formData).join(' ');
      
      const securityUtils = loadSecurityValidation();
      const sensitiveCheck = securityUtils.detectSensitiveData(allContent);
      
      if (sensitiveCheck.hasSensitiveData && sensitiveCheck.riskLevel === 'high') {
        const confirmMessage = `é«˜ãƒªã‚¹ã‚¯ã®å€‹äººæƒ…å ±ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚\n\næœ¬å½“ã«é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ\n\næ¤œå‡ºé …ç›®:\n${
          sensitiveCheck.detectedItems.map(item => `ãƒ»${item.type}: ${item.count}ä»¶`).join('\n')
        }`;
        
        return confirm(confirmMessage);
      }
      
      return true;
    }
  </script>

  <style>
    .info-box {
      margin: 20px 0;
    }

    .info-box h4 {
      margin: 0 0 10px 0;
      color: #1976d2;
    }

    details {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
    }

    details summary {
      font-weight: bold;
      padding: 5px 0;
      outline: none;
    }

    details[open] summary {
      border-bottom: 1px solid #ddd;
      margin-bottom: 10px;
      padding-bottom: 10px;
    }

    .checkbox-item {
      display: flex;
      align-items: flex-start;
      margin: 10px 0;
    }

    .checkbox-item input[type="checkbox"] {
      margin-right: 10px;
      margin-top: 2px;
      width: auto;
    }

    .checkbox-item span {
      flex: 1;
    }

    small {
      display: block;
      margin-top: 5px;
      font-size: 12px;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</body>
</html>
