<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Firebaseæ¥ç¶šè¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>

  <div id="results"></div>

  <button onclick="runDiagnostics()" style="padding: 10px 20px; font-size: 16px;">è¨ºæ–­å®Ÿè¡Œ</button>

  <!-- Firebase SDKã‚’CDNã‹ã‚‰èª­ã¿è¾¼ã¿ -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    function addResult(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.innerHTML = message;
      document.getElementById('results').appendChild(div);
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '';
    }

    async function runDiagnostics() {
      clearResults();

      addResult('ğŸ” Firebaseè¨ºæ–­ã‚’é–‹å§‹ã—ã¾ã™...', 'info');

      // Step 1: Firebase SDK ç¢ºèª
      try {
        if (typeof window.firebase === 'undefined') {
          addResult('âŒ Firebase SDK ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
          return;
        } else {
          addResult('âœ… Firebase SDK ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
          addResult(`ğŸ“¦ Firebase ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${firebase.SDK_VERSION}`, 'info');
        }
      } catch (error) {
        addResult(`âŒ Firebase SDK ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        return;
      }

      // Step 2: Firebase è¨­å®š
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyC8_B2eo47C2plYkGPq_ek6VaD113tNEBk",
          authDomain: "oral-health-diagnosis-ap-b3592.firebaseapp.com",
          projectId: "oral-health-diagnosis-ap-b3592",
          storageBucket: "oral-health-diagnosis-ap-b3592.firebasestorage.app",
          messagingSenderId: "338073541462",
          appId: "1:338073541462:web:f48f281cf84710ce7794f7",
          measurementId: "G-XLQ1FVCHN5"
        };

        addResult('ğŸ”§ Firebase è¨­å®šå€¤:', 'info');
        addResult(`<pre>${JSON.stringify(firebaseConfig, null, 2)}</pre>`, 'info');

        // Step 3: FirebaseåˆæœŸåŒ–
        let app;
        if (!firebase.apps.length) {
          app = firebase.initializeApp(firebaseConfig);
          addResult('âœ… Firebase ã‚¢ãƒ—ãƒªãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ', 'success');
        } else {
          app = firebase.app();
          addResult('âœ… æ—¢å­˜ã® Firebase ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™', 'success');
        }

        addResult(`ğŸ“± ã‚¢ãƒ—ãƒªå: ${app.name}`, 'info');
        addResult(`ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID: ${app.options.projectId}`, 'info');

        // Step 4: Auth ã‚µãƒ¼ãƒ“ã‚¹
        try {
          const auth = firebase.auth();
          addResult('âœ… Firebase Authentication ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã§ã™', 'success');

          // èªè¨¼çŠ¶æ…‹ç¢ºèª
          const user = auth.currentUser;
          if (user) {
            addResult(`ğŸ‘¤ ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${user.email}`, 'success');
          } else {
            addResult('ğŸ‘¤ ç¾åœ¨æœªãƒ­ã‚°ã‚¤ãƒ³ã§ã™', 'info');
          }
        } catch (authError) {
          addResult(`âŒ Authentication ã‚¨ãƒ©ãƒ¼: ${authError.message}`, 'error');
        }

        // Step 5: Firestore ã‚µãƒ¼ãƒ“ã‚¹
        try {
          const firestore = firebase.firestore();
          addResult('âœ… Firebase Firestore ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã§ã™', 'success');

          // æ¥ç¶šãƒ†ã‚¹ãƒˆ
          await firestore.enableNetwork();
          addResult('âœ… Firestore ã¸ã®æ¥ç¶šãŒç¢ºèªã§ãã¾ã—ãŸ', 'success');

        } catch (firestoreError) {
          addResult(`âŒ Firestore ã‚¨ãƒ©ãƒ¼: ${firestoreError.message}`, 'error');
        }

        // Step 6: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãƒ†ã‚¹ãƒˆ
        try {
          const response = await fetch('https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js', {
            method: 'HEAD'
          });

          if (response.ok) {
            addResult('âœ… Firebase CDN ã¸ã®æ¥ç¶šãŒæ­£å¸¸ã§ã™', 'success');
          } else {
            addResult(`âš ï¸ Firebase CDN æ¥ç¶šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ (${response.status})`, 'error');
          }
        } catch (networkError) {
          addResult(`âŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ${networkError.message}`, 'error');
        }

        addResult('ğŸ‰ è¨ºæ–­ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');

      } catch (error) {
        addResult(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        console.error('Firebaseè¨ºæ–­ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', () => {
      addResult('ğŸ“‹ Firebase è¨ºæ–­ãƒ„ãƒ¼ãƒ«ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸ', 'info');
    });
  </script>
</body>
</html>