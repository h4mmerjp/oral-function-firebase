<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; 
                script-src 'self' 'unsafe-inline' https://www.gstatic.com https://apis.google.com https://pagead2.googlesyndication.com; 
                style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
                font-src 'self' https://fonts.gstatic.com; 
                img-src 'self' data: https: blob:; 
                connect-src 'self' https://*.firebaseio.com https://*.googleapis.com https://*.firebaseapp.com wss://*.firebaseio.com; 
                frame-src 'self' https://accounts.google.com https://content.googleapis.com https://*.firebaseapp.com;"
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta
      http-equiv="Referrer-Policy"
      content="strict-origin-when-cross-origin"
    />

    <!-- AdSenseå¯©æŸ»ç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
    <meta
      name="description"
      content="æ—¥æœ¬è€å¹´æ­¯ç§‘åŒ»å­¦ä¼šåŸºæº–ã«åŸºã¥ãå£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã®è¨ºæ–­ãƒ»ç®¡ç†ãƒ„ãƒ¼ãƒ«ã€‚æ­¯ç§‘åŒ»å¸«ãƒ»æ­¯ç§‘è¡›ç”Ÿå£«å‘ã‘ã®è¨ºæ–­è£œåŠ©ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚"
    />
    <meta
      name="keywords"
      content="å£è…”æ©Ÿèƒ½,æ­¯ç§‘,è¨ºæ–­,ç®¡ç†,åŒ»ç™‚å¾“äº‹è€…,å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡,æ—¥æœ¬è€å¹´æ­¯ç§‘åŒ»å­¦ä¼š"
    />
    <meta name="author" content="å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒª" />

    <title>
      å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒª - æ­¯ç§‘åŒ»ç™‚å¾“äº‹è€…å‘ã‘è¨ºæ–­æ”¯æ´ãƒ„ãƒ¼ãƒ«
    </title>
    <link rel="stylesheet" href="styles.css" />

</head>
  <body>
    <div class="container">
      <header>
        <h1>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒª</h1>
        <p>æ—¥æœ¬è€å¹´æ­¯ç§‘åŒ»å­¦ä¼šã®åŸºæº–ã«åŸºã¥ãè¨ºæ–­ãƒ»ç®¡ç†ãƒ„ãƒ¼ãƒ«</p>
        <div style="margin-top: 10px">
          <button onclick="exportDatabaseCSV()" class="btn-secondary no-print">
            CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          </button>
          <button onclick="window.print()" class="btn-secondary no-print">
            å°åˆ·
          </button>
        </div>
      </header>

      <div class="tabs no-print">
        <div class="tab active" onclick="openTab('patient-list')">æ‚£è€…ä¸€è¦§</div>
        <div class="tab" onclick="openTab('patient-info')">æ‚£è€…æƒ…å ±</div>
        <div class="tab" onclick="openTab('assessment')">å£è…”æ©Ÿèƒ½ç²¾å¯†æ¤œæŸ»</div>
        <div class="tab" onclick="openTab('diagnosis')">è¨ºæ–­çµæœ</div>
        <div class="tab" onclick="openTab('management-plan')">ç®¡ç†è¨ˆç”»æ›¸</div>
        <div class="tab" onclick="openTab('progress-record')">
          ç®¡ç†æŒ‡å°è¨˜éŒ²ç°¿
        </div>
        <div class="tab" onclick="openTab('patient-history')">å±¥æ­´ãƒ»çµ±è¨ˆ</div>
        <div class="tab" onclick="openTab('information')">å‚è€ƒæƒ…å ±</div>
        <div class="tab" onclick="openTab('contact')">ãŠå•ã„åˆã‚ã›</div>
      </div>

      <!-- Patient List Tab -->
      <div id="patient-list" class="tab-content active">
        <h2>æ‚£è€…ä¸€è¦§</h2>

        <div class="search-container">
          <input
            type="text"
            id="search-patients"
            placeholder="æ‚£è€…åã€æ‚£è€…IDã§æ¤œç´¢..."
            onkeyup="searchPatients()"
          />
          <select id="filter-status" onchange="filterPatients()">
            <option value="">ã™ã¹ã¦è¡¨ç¤º</option>
            <option value="diagnosed">å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡</option>
            <option value="normal">æ­£å¸¸</option>
            <option value="pending">æœªè¨ºæ–­</option>
          </select>
          <button onclick="showAddPatientModal()" class="btn-success">
            æ–°è¦æ‚£è€…ç™»éŒ²
          </button>
        </div>

        <div id="patients-grid" class="grid-container">
          <div class="no-patients">
            <p>ç™»éŒ²ã•ã‚ŒãŸæ‚£è€…ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <button onclick="showAddPatientModal()" class="btn-success">
              æœ€åˆã®æ‚£è€…ã‚’ç™»éŒ²
            </button>
          </div>
        </div>
      </div>

      <!-- Patient Information Tab -->
      <div id="patient-info" class="tab-content">
        <h2>æ‚£è€…åŸºæœ¬æƒ…å ±</h2>
        <div id="patient-info-content">
          <p>æ‚£è€…ä¸€è¦§ã‹ã‚‰æ‚£è€…ã‚’é¸æŠã™ã‚‹ã‹ã€æ–°è¦ç™»éŒ²ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p>
        </div>
      </div>

      <!-- Assessment Tab -->
      <div id="assessment" class="tab-content">
        <h2>å£è…”æ©Ÿèƒ½ç²¾å¯†æ¤œæŸ»</h2>
        <div id="assessment-content">
          <p>æ‚£è€…ã‚’é¸æŠã—ã¦ã‹ã‚‰æ¤œæŸ»ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
      </div>

      <!-- Diagnosis Tab -->
      <div id="diagnosis" class="tab-content">
        <h2>è¨ºæ–­çµæœ</h2>
        <div id="diagnosis-content">
          <p>æ¤œæŸ»å®Œäº†å¾Œã«è¨ºæ–­çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        </div>
      </div>

      <!-- Management Plan Tab -->
      <div id="management-plan" class="tab-content">
        <h2>ç®¡ç†è¨ˆç”»æ›¸</h2>
        <div id="management-plan-content">
          <p>è¨ºæ–­å®Œäº†å¾Œã«ç®¡ç†è¨ˆç”»æ›¸ãŒä½œæˆã§ãã¾ã™ã€‚</p>
        </div>
      </div>

      <!-- Progress Record Tab -->
      <div id="progress-record" class="tab-content">
        <h2>ç®¡ç†æŒ‡å°è¨˜éŒ²ç°¿</h2>
        <div id="progress-record-content">
          <p>æ‚£è€…ã‚’é¸æŠã—ã¦ç®¡ç†æŒ‡å°è¨˜éŒ²ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
      </div>

      <!-- Patient History Tab -->
      <div id="patient-history" class="tab-content">
        <h2>å±¥æ­´ãƒ»çµ±è¨ˆ</h2>
        <div id="patient-history-content">
          <p>æ‚£è€…ã‚’é¸æŠã—ã¦å±¥æ­´ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
        </div>
      </div>

      <!-- Information Tab -->
      <div id="information" class="tab-content">
        <h2>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã«é–¢ã™ã‚‹å‚è€ƒæƒ…å ±</h2>

        <div class="summary-card">
          <h3>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã¨ã¯</h3>
          <p>
            å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã¯ã€åŠ é½¢ã ã‘ã§ãªãï¼Œç–¾æ‚£ã‚„éšœå®³ãªã©æ§˜ã€…ãªè¦å› ã«ã‚ˆã£ã¦ï¼Œå£è…”ã®æ©Ÿèƒ½ãŒè¤‡åˆçš„ã«ä½ä¸‹ã—ã¦ã„ã‚‹ç–¾æ‚£ã§ã™ã€‚æ”¾ç½®ã—ã¦ãŠãã¨å’€åš¼éšœå®³ï¼Œæ‘‚é£Ÿåš¥ä¸‹éšœå®³ãªã©å£è…”ã®æ©Ÿèƒ½éšœå®³ã‚’å¼•ãèµ·ã“ã—ï¼Œã¾ãŸï¼Œä½æ „é¤Šã‚„ãƒ•ãƒ¬ã‚¤ãƒ«ã€ã‚µãƒ«ã‚³ãƒšãƒ‹ã‚¢ã‚’é€²å±•ã•ã›ã‚‹ãªã©å…¨èº«ã®å¥åº·ã‚’æãªã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
          </p>
          <p>
            å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã®7ã¤ã®ä¸‹ä½ç—‡çŠ¶ï¼ˆå£è…”è¡›ç”ŸçŠ¶æ…‹ä¸è‰¯ï¼Œå£è…”ä¹¾ç‡¥ï¼Œå’¬åˆåŠ›ä½ä¸‹ï¼ŒèˆŒå£å”‡é‹å‹•æ©Ÿèƒ½ä½ä¸‹ï¼Œä½èˆŒåœ§ï¼Œå’€åš¼æ©Ÿèƒ½ä½ä¸‹ï¼Œåš¥ä¸‹æ©Ÿèƒ½ä½ä¸‹ï¼‰ã®ã†ã¡ï¼Œ3é …ç›®ä»¥ä¸Šè©²å½“ã™ã‚‹å ´åˆã«å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã¨è¨ºæ–­ã•ã‚Œã¾ã™ã€‚
          </p>
        </div>

        <div class="summary-card">
          <h3>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã¨ã‚ªãƒ¼ãƒ©ãƒ«ãƒ•ãƒ¬ã‚¤ãƒ«</h3>
          <p>
            ã‚ªãƒ¼ãƒ©ãƒ«ãƒ•ãƒ¬ã‚¤ãƒ«ã¯ã€ã‚ãšã‹ãªã‚€ã›ã‚„é£Ÿã¹ã“ã¼ã—ã€æ»‘èˆŒã®ä½ä¸‹ã¨ã„ã£ãŸå£è…”æ©Ÿèƒ½ãŒä½ä¸‹ã—ãŸçŠ¶æ…‹ã‚’ç¤ºã™ã‚‚ã®ã§ã‚ã‚Šã€å›½æ°‘ã®å•“ç™ºã«ç”¨ã„ã‚‹ç”¨èªï¼ˆã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºï¼‰ã§ã™ã€‚
          </p>
          <p>
            ä¸€æ–¹ã€å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã¯ã€æ¤œæŸ»çµæœã«åŸºã¥ãç–¾æ‚£åã§ã™ã€‚å¾“ã£ã¦ã€ã‚ªãƒ¼ãƒ©ãƒ«ãƒ•ãƒ¬ã‚¤ãƒ«ã¨å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã•ã‚Œã‚‹éƒ¨åˆ†ãŒå¤šãã€åŒºåˆ¥ã•ã‚Œã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
          </p>
        </div>

        <div class="summary-card">
          <h3>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã®ç®¡ç†</h3>
          <p>
            å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã®ç®¡ç†ã¯ï¼Œå£è…”æ©Ÿèƒ½ã®ã•ã‚‰ãªã‚‹æ‚ªåŒ–ã‚’äºˆé˜²ã—ï¼Œå£è…”æ©Ÿèƒ½ã‚’ç¶­æŒï¼Œå›å¾©ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¾ã™ã€‚
          </p>
          <h4>å„ç—‡çŠ¶ã®ç®¡ç†æ–¹æ³•ä¾‹</h4>
          <table>
            <thead>
              <tr>
                <th>ç—‡çŠ¶ãƒ»çŠ¶æ…‹</th>
                <th>ç®¡ç†æ–¹æ³•ã®ä¾‹</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>å£è…”è¡›ç”ŸçŠ¶æ…‹ä¸è‰¯</td>
                <td>
                  æ­¯ç§‘åŒ»å¸«ãƒ»æ­¯ç§‘è¡›ç”Ÿå£«ã«ã‚ˆã‚‹å£è…”è¡›ç”Ÿç®¡ç†ã€æ‚£è€…ã‚„å®¶æ—ç­‰ã«ã‚ˆã‚‹å£è…”ã‚±ã‚¢ã®æŒ‡å°
                </td>
              </tr>
              <tr>
                <td>å£è…”ä¹¾ç‡¥</td>
                <td>
                  æ°´åˆ†ç®¡ç†ãƒ»æ°´åˆ†è£œçµ¦ã®æŒ‡å°ã€å”¾æ¶²è…ºãƒãƒƒã‚µãƒ¼ã‚¸ã®æŒ‡å°ãƒ»å¥å£ä½“æ“ã€å£è…”ä¿æ¹¿å‰¤ã®æŒ‡å°
                </td>
              </tr>
              <tr>
                <td>å£å”‡ãƒ»èˆŒã®æ©Ÿèƒ½ä½ä¸‹</td>
                <td>
                  ã€Œãƒ‘ã€ã€Œã‚¿ã€ã€Œã‚«ã€ã®ç¹°ã‚Šè¿”ã—ç™ºéŸ³è¨“ç·´ã®æŒ‡å°ã€å£å”‡ãƒ»èˆŒã®è‡ªå‹•é‹å‹•ã®æŒ‡å°
                </td>
              </tr>
              <tr>
                <td>å’¬åˆåŠ›ãƒ»å’€åš¼æ©Ÿèƒ½ã®ä½ä¸‹</td>
                <td>å’¬åˆæ”¯æŒã®ç¢ºç«‹ï¼Œç¾©æ­¯ã®è£½ä½œãƒ»èª¿æ•´ã€å’€åš¼æŒ‡å°ã€é£Ÿäº‹æŒ‡å°</td>
              </tr>
              <tr>
                <td>åš¥ä¸‹æ©Ÿèƒ½ã®ä½ä¸‹</td>
                <td>åš¥ä¸‹ä½“æ“ã®æŒ‡å°ã€é–‹å£è¨“ç·´ã€åš¥ä¸‹ã®é–“æ¥è¨“ç·´ãƒ»ç›´æ¥è¨“ç·´</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="summary-card">
           <h3>å‚è€ƒè³‡æ–™ãƒ»ãƒªãƒ³ã‚¯</h3>
        <ul>
          <li><a href="https://www.jads.jp/assets/pdf/basic/r06/document-240329.pdf" target="_blank" rel="noopener noreferrer">æ—¥æœ¬æ­¯ç§‘åŒ»å­¦ä¼šï¼šå£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡ã«é–¢ã™ã‚‹åŸºæœ¬çš„ãªè€ƒãˆæ–¹</a></li>
          <li><a href="https://www.gerodontology.jp/" target="_blank" rel="noopener noreferrer">æ—¥æœ¬è€å¹´æ­¯ç§‘åŒ»å­¦ä¼šï¼šå…¬å¼ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a></li>
        </ul>
        </div>
      </div>

      <!-- Contact Tab -->
      <div id="contact" class="tab-content">
        <h2>ãŠå•ã„åˆã‚ã›</h2>
        
        <div id="auth-required-message" class="summary-card" style="background: #fff3cd; border: 1px solid #ffeaa7; display: none;">
          <h3>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h3>
          <p>ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã”åˆ©ç”¨ã„ãŸã ãã«ã¯ã€Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
          <p>ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè‡ªå‹•çš„ã«å…¥åŠ›ã•ã‚Œã€ã‚ˆã‚Šå®‰å…¨ã«ãŠå•ã„åˆã‚ã›ã„ãŸã ã‘ã¾ã™ã€‚</p>
          <div style="text-align: center; margin-top: 15px;">
            <button onclick="firebaseManager.signInWithGoogle()" class="btn-success">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
          </div>
        </div>

        <div id="contact-form-container" style="display: none;">
          <div class="summary-card">
            <p>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒªã«é–¢ã™ã‚‹ã”è³ªå•ãƒ»ã”è¦æœ›ãƒ»ä¸å…·åˆå ±å‘Šç­‰ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>

            <div class="info-box" style="background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; border-radius: 4px; margin: 20px 0;">
              <h4>ğŸ”’ èªè¨¼æ¸ˆã¿ã‚µãƒãƒ¼ãƒˆ</h4>
              <p>ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ã«ã‚ˆã‚Šã€ã‚ˆã‚Šå®‰å…¨ã§è¿…é€Ÿãªã‚µãƒãƒ¼ãƒˆã‚’æä¾›ã„ãŸã—ã¾ã™ã€‚</p>
              <p><strong>24æ™‚é–“ä»¥å†…ã«è‡ªå‹•å¿œç­”ã‚·ã‚¹ãƒ†ãƒ ãŒãŠç­”ãˆã—ã¾ã™ã€‚</strong></p>
            </div>

            <form id="authenticated-contact-form">
              <div class="form-group">
                <label for="auth-contact-name">ãŠåå‰ *</label>
                <input type="text" id="auth-contact-name" required readonly style="background: #f8f9fa;">
                <small style="color: #666;">â€» ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‹ã‚‰è‡ªå‹•å…¥åŠ›</small>
              </div>
              
              <div class="form-group">
                <label for="auth-contact-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
                <input type="email" id="auth-contact-email" required readonly style="background: #f8f9fa;">
                <small style="color: #666;">â€» ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆç·¨é›†ä¸å¯ï¼‰</small>
              </div>
              
              <div class="form-group">
                <label for="auth-contact-category">ãŠå•ã„åˆã‚ã›ç¨®åˆ¥ *</label>
                <select id="auth-contact-category" required>
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="bug">ä¸å…·åˆå ±å‘Š</option>
                  <option value="feature">æ©Ÿèƒ½è¦æœ›</option>
                  <option value="question">ä½¿ã„æ–¹ã«ã¤ã„ã¦</option>
                  <option value="account">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³</option>
                  <option value="performance">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»é€Ÿåº¦</option>
                  <option value="ui">UIãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³</option>
                  <option value="compatibility">ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ</option>
                  <option value="documentation">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ˜ãƒ«ãƒ—</option>
                  <option value="security">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</option>
                  <option value="other">ãã®ä»–</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="auth-contact-title">ã‚¿ã‚¤ãƒˆãƒ« *</label>
                <input type="text" id="auth-contact-title" required placeholder="ä¾‹ï¼šæ¤œæŸ»çµæœãŒä¿å­˜ã•ã‚Œãªã„ã€æ‚£è€…ç™»éŒ²ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€ãªã©">
              </div>
              
              <div class="form-group">
                <label for="auth-contact-message">è©³ç´°å†…å®¹ *</label>
                <textarea id="auth-contact-message" rows="8" required placeholder="å…·ä½“çš„ãªçŠ¶æ³ã‚„æ‰‹é †ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚

ã€æ¨å¥¨è¨˜è¼‰å†…å®¹ã€‘
- ç™ºç”ŸçŠ¶æ³ï¼ˆã„ã¤ã€ã©ã“ã§ã€ä½•ã‚’ã—ãŸæ™‚ã«ï¼‰
- ä½¿ç”¨ç’°å¢ƒï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã€OSã€ãƒ‡ãƒã‚¤ã‚¹ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚ã‚Œã°ï¼‰
- æœŸå¾…ã™ã‚‹å‹•ä½œ"></textarea>
              </div>
              
              <div class="form-group">
                <label for="auth-contact-browser">ä½¿ç”¨ç’°å¢ƒï¼ˆä»»æ„ï¼‰</label>
                <input type="text" id="auth-contact-browser" placeholder="ä¾‹ï¼šChrome 120, Windows 11, iPhone Safari ãªã©">
              </div>

              <div class="form-group">
                <label class="checkbox-item">
                  <input type="checkbox" id="auth-privacy-agreement" required>
                  <span>å€‹äººæƒ…å ±ã‚„æ‚£è€…æƒ…å ±ã‚’å«ã¾ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸ</span>
                </label>
              </div>

              <div class="form-group">
                <label class="checkbox-item">
                  <input type="checkbox" id="auth-terms-agreement" required>
                  <span>ãŠå•ã„åˆã‚ã›å†…å®¹ã®å‡¦ç†ã¨æŠ€è¡“ã‚µãƒãƒ¼ãƒˆã§ã®ä½¿ç”¨ã«åŒæ„ã—ã¾ã™</span>
                </label>
              </div>
              
              <div class="form-group">
                <button type="button" onclick="submitAuthenticatedContact()" class="btn-success">ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡</button>
                <button type="button" onclick="resetAuthContactForm()" class="btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
              </div>

              <div id="auth-submission-status" style="display: none; margin-top: 15px;"></div>
            </form>
          </div>

          <div class="summary-card">
            <h3>â“ ã‚ˆãã‚ã‚‹ã”è³ªå•</h3>
            <p>ã‚ˆãã‚ã‚‹ã”è³ªå•ã¯ã€<a href="faq.html" target="_blank">å°‚ç”¨ãƒšãƒ¼ã‚¸</a>ã§ãƒ­ã‚°ã‚¤ãƒ³ãªã—ã§ã‚‚ã”è¦§ã„ãŸã ã‘ã¾ã™ã€‚</p>
            <div style="text-align: center; margin: 15px 0;">
              <button onclick="window.open('faq.html', '_blank')" class="btn-secondary">ã‚ˆãã‚ã‚‹è³ªå•ã‚’è¦‹ã‚‹</button>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- Release Notes Section -->
    <footer class="app-footer no-print">
      <div
        style="
          text-align: center;
          padding: 20px;
          border-top: 1px solid #eee;
          margin-top: 30px;
        "
      >
        <!-- å¿…é ˆãƒªãƒ³ã‚¯ -->
        <div style="margin-bottom: 15px">
          <a href="about.html" style="margin: 0 10px">ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦</a>
          <a href="privacy-policy.html" style="margin: 0 10px"
            >ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a
          >
          <a href="terms-of-service.html" style="margin: 0 10px">åˆ©ç”¨è¦ç´„</a>
          <a href="contact.html" style="margin: 0 10px">ãŠå•ã„åˆã‚ã›</a>
        </div>

        <!-- ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
        <button
          onclick="showReleaseNotes()"
          class="btn-secondary"
          style="margin: 5px"
        >
          ğŸ“‹ æ›´æ–°æƒ…å ±ãƒ»ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ
        </button>

        <!-- ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆã¨ã‚¢ãƒ—ãƒªèª¬æ˜ -->
        <p style="font-size: 12px; color: #666; margin: 10px 0">
          å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒª | æ—¥æœ¬è€å¹´æ­¯ç§‘åŒ»å­¦ä¼šåŸºæº–æº–æ‹ 
        </p>

        <p style="font-size: 11px; color: #999; margin: 5px 0">
          â€»
          æœ¬ã‚¢ãƒ—ãƒªã¯è¨ºæ–­è£œåŠ©ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æœ€çµ‚çš„ãªè¨ºæ–­ã¯åŒ»ç™‚å¾“äº‹è€…ãŒè¡Œã£ã¦ãã ã•ã„ã€‚
        </p>

      </div>
    </footer>

    <!-- Release Notes Modal -->
    <div id="releaseNotesModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeReleaseNotesModal()">&times;</span>
        <h2>ğŸ“‹ æ›´æ–°æƒ…å ±ãƒ»ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ</h2>
        <div id="release-notes-content">
          <div style="text-align: center; padding: 20px">
            <p>æ›´æ–°æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Patient Modal -->
    <div id="addPatientModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeAddPatientModal()">&times;</span>
        <h2 id="modal-title">æ–°è¦æ‚£è€…ç™»éŒ²</h2>
        <form id="patient-form">
          <input type="hidden" id="edit-patient-id" />

          <div class="grid-container">
            <div class="form-group">
              <label for="modal-patient-name">æ‚£è€…æ°å *</label>
              <input type="text" id="modal-patient-name" required />
            </div>
            <div class="form-group">
              <label for="modal-patient-id">æ‚£è€…ID *</label>
              <input type="text" id="modal-patient-id" required />
            </div>
            <div class="form-group">
              <label for="modal-patient-kana">ãƒ•ãƒªã‚¬ãƒŠ</label>
              <input type="text" id="modal-patient-kana" />
            </div>
            <div class="form-group">
              <label for="modal-birthdate">ç”Ÿå¹´æœˆæ—¥</label>
              <input type="date" id="modal-birthdate" />
            </div>
            <div class="form-group">
              <label for="modal-gender">æ€§åˆ¥</label>
              <select id="modal-gender">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="male">ç”·æ€§</option>
                <option value="female">å¥³æ€§</option>
              </select>
            </div>
            <div class="form-group">
              <label for="modal-phone">é›»è©±ç•ªå·</label>
              <input type="tel" id="modal-phone" />
            </div>
          </div>

          <div class="form-group">
            <label for="modal-address">ä½æ‰€</label>
            <textarea id="modal-address" rows="3"></textarea>
          </div>

          <div style="text-align: right; margin-top: 20px">
            <button
              type="button"
              onclick="closeAddPatientModal()"
              class="btn-secondary"
            >
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
            <button type="submit" class="btn-success">ä¿å­˜</button>
          </div>
        </form>
      </div>
    </div>

    <!-- File input for import -->

    <!-- Firebase SDKã‚’CDNã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆv8 compatç‰ˆã‚’ä½¿ç”¨ï¼‰ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿é †åºã‚’æœ€é©åŒ– -->
    <script>
      // åˆæœŸåŒ–çŠ¶æ³ã‚’ç›£è¦–ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ©ã‚°
      window.appInitStatus = {
        database: false,
        patients: false,
        assessment: false,
        management: false,
        firebase: false,
        security: false,
        app: false,
      };

      // åˆæœŸåŒ–å®Œäº†ã‚’ç›£è¦–ã™ã‚‹é–¢æ•°
      function checkInitialization() {
        const allInitialized = Object.values(window.appInitStatus).every(
          (status) => status
        );
        if (allInitialized) {
          console.log("ã™ã¹ã¦ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒåˆæœŸåŒ–å®Œäº†ã—ã¾ã—ãŸ");
          console.log("åˆæœŸåŒ–çŠ¶æ³:", window.appInitStatus);
        } else {
          console.log("åˆæœŸåŒ–å¾…æ©Ÿä¸­:", window.appInitStatus);
        }
      }
    </script>

    <!-- Firebaseè¨­å®šã‚’æœ€åˆã«èª­ã¿è¾¼ã¿ -->
    <script src="firebase-config.js"></script>
    <script>
      if (typeof firebaseManager !== "undefined") {
        window.appInitStatus.firebase = true;
        console.log("firebase-config.js èª­ã¿è¾¼ã¿å®Œäº†");

        // FirebaseåˆæœŸåŒ–ã‚’éåŒæœŸã§å®Ÿè¡Œ
        firebaseManager.initialize().then((success) => {
          if (success) {
            console.log("Firebase åˆæœŸåŒ–æˆåŠŸ");
          } else {
            console.log("Firebase åˆæœŸåŒ–å¤±æ•— - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ç¶šè¡Œ");
          }
        });
      }
    </script>

    <script src="database.js"></script>
    <script>
      if (typeof db !== "undefined") {
        window.appInitStatus.database = true;
        console.log("database.js èª­ã¿è¾¼ã¿å®Œäº†");
      }
    </script>

    <script src="patients.js"></script>
    <script>
      if (typeof patientManager !== "undefined") {
        window.appInitStatus.patients = true;
        console.log("patients.js èª­ã¿è¾¼ã¿å®Œäº†");
      }
    </script>

    <script src="assessment.js"></script>
    <script>
      if (typeof assessmentManager !== "undefined") {
        window.appInitStatus.assessment = true;
        console.log("assessment.js èª­ã¿è¾¼ã¿å®Œäº†");
      }
    </script>

    <script src="management.js"></script>
    <script>
      if (typeof managementManager !== "undefined") {
        window.appInitStatus.management = true;
        console.log("management.js èª­ã¿è¾¼ã¿å®Œäº†");
      }
    </script>

    <script src="security.js"></script>
    <script>
      if (typeof securityUtils !== "undefined") {
        window.appInitStatus.security = true;
        console.log("security.js èª­ã¿è¾¼ã¿å®Œäº†");
      }
    </script>

    <script src="app.js"></script>

    <script>
      if (typeof app !== "undefined" || typeof OralHealthApp !== "undefined") {
        window.appInitStatus.app = true;
        console.log("app.js èª­ã¿è¾¼ã¿å®Œäº†");
      }

      // æœ€çµ‚çš„ãªåˆæœŸåŒ–çŠ¶æ³ã‚’ç¢ºèª
      setTimeout(checkInitialization, 1000);

      // Contact form authentication check
      function checkContactAuthentication() {
        const user = firebaseManager.getCurrentUser();
        const authMessage = document.getElementById('auth-required-message');
        const formContainer = document.getElementById('contact-form-container');
        
        if (user) {
          // User is authenticated
          authMessage.style.display = 'none';
          formContainer.style.display = 'block';
          
          // Auto-populate user information
          document.getElementById('auth-contact-name').value = user.displayName || user.email.split('@')[0];
          document.getElementById('auth-contact-email').value = user.email;
        } else {
          // User is not authenticated
          authMessage.style.display = 'block';
          formContainer.style.display = 'none';
        }
      }

      // Handle authenticated contact form submission
      async function submitAuthenticatedContact() {
        if (!validateAuthContactForm()) return;
        
        const submitButton = document.querySelector('button[onclick="submitAuthenticatedContact()"]');
        const statusDiv = document.getElementById('auth-submission-status');
        
        submitButton.disabled = true;
        submitButton.textContent = 'é€ä¿¡ä¸­...';
        statusDiv.style.display = 'block';
        statusDiv.innerHTML = '<div style="color: #2196f3;">ğŸ“¤ ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡ä¸­...</div>';

        try {
          const formData = collectAuthContactFormData();
          
          const response = await fetch('/api/contact', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });

          const result = await response.json();

          if (response.ok) {
            statusDiv.innerHTML = `
              <div style="color: #4caf50; background: #e8f5e8; padding: 15px; border-radius: 4px;">
                <h4>âœ… é€ä¿¡å®Œäº†</h4>
                <p>${result.message}</p>
                <div style="margin: 10px 0; padding: 10px; background: #f0f7ff; border-radius: 4px;">
                  <strong>ğŸ“‹ å—ä»˜è©³ç´°:</strong><br>
                  <small>
                    â€¢ æŠ•ç¨¿ID: <code>${result.details.submissionId}</code><br>
                    â€¢ ã‚«ãƒ†ã‚´ãƒªãƒ¼: ${result.details.category}<br>
                    â€¢ äºˆæƒ³å¿œç­”æ™‚é–“: ${result.details.estimatedResponseTime}
                  </small>
                </div>
                <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong></p>
                <ul style="margin: 5px 0; padding-left: 20px;">
                  ${result.details.nextSteps.map(step => `<li>${step}</li>`).join('')}
                </ul>
              </div>
            `;
            
            setTimeout(() => {
              resetAuthContactForm();
            }, 5000);

          } else {
            throw new Error(result.message || 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
          }

        } catch (error) {
          console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
          statusDiv.innerHTML = `
            <div style="color: #f44336; background: #ffebee; padding: 15px; border-radius: 4px;">
              <h4>âŒ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ</h4>
              <p>${error.message}</p>
              <p>ãŠæ‰‹æ•°ã§ã™ãŒã€ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>
            </div>
          `;
        } finally {
          submitButton.disabled = false;
          submitButton.textContent = 'ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡';
        }
      }

      // Validate authenticated contact form
      function validateAuthContactForm() {
        const category = document.getElementById('auth-contact-category').value;
        const title = document.getElementById('auth-contact-title').value.trim();
        const message = document.getElementById('auth-contact-message').value.trim();
        const privacyAgreed = document.getElementById('auth-privacy-agreement').checked;
        const termsAgreed = document.getElementById('auth-terms-agreement').checked;

        if (!category || !title || !message) {
          alert('å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          return false;
        }

        if (!privacyAgreed || !termsAgreed) {
          alert('ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨åˆ©ç”¨è¦ç´„ã®ç¢ºèªäº‹é …ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚');
          return false;
        }

        return true;
      }

      // Collect authenticated contact form data
      function collectAuthContactFormData() {
        return {
          name: document.getElementById('auth-contact-name').value.trim(),
          email: document.getElementById('auth-contact-email').value.trim(),
          category: document.getElementById('auth-contact-category').value,
          title: document.getElementById('auth-contact-title').value.trim(),
          message: document.getElementById('auth-contact-message').value.trim(),
          browser: document.getElementById('auth-contact-browser').value.trim(),
          authenticated: true
        };
      }

      // Reset authenticated contact form
      function resetAuthContactForm() {
        document.getElementById('auth-contact-category').value = '';
        document.getElementById('auth-contact-title').value = '';
        document.getElementById('auth-contact-message').value = '';
        document.getElementById('auth-contact-browser').value = '';
        document.getElementById('auth-privacy-agreement').checked = false;
        document.getElementById('auth-terms-agreement').checked = false;
        document.getElementById('auth-submission-status').style.display = 'none';
      }

      // Add listener to check authentication when contact tab is opened
      const originalOpenTab = window.openTab;
      window.openTab = function(tabName) {
        originalOpenTab(tabName);
        if (tabName === 'contact') {
          setTimeout(checkContactAuthentication, 100);
        }
      };

      // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
      window.addEventListener("keydown", function (e) {
        if (e.ctrlKey && e.shiftKey && e.key === "F") {
          if (window.fbDebug) {
            fbDebug();
          }
        }
      });
    </script>
  </body>
</html>
