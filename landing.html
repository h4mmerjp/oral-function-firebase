<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; 
                script-src 'self' 'unsafe-inline' https://www.gstatic.com https://apis.google.com; 
                style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
                font-src 'self' https://fonts.gstatic.com; 
                img-src 'self' data: https:; 
                connect-src 'self' https://*.firebaseio.com https://*.googleapis.com https://*.firebaseapp.com wss://*.firebaseio.com; 
                frame-src 'self' https://accounts.google.com https://content.googleapis.com https://*.firebaseapp.com;"
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    
    <title>å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒª - ãƒ­ã‚°ã‚¤ãƒ³</title>
    <link rel="stylesheet" href="styles.css">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .landing-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .app-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
        }

        .app-title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .app-subtitle {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .login-section {
            margin: 30px 0;
        }

        .google-login-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            gap: 12px;
            margin: 10px 0;
        }

        .google-login-btn:hover {
            background: #357ae8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        }

        .google-login-btn:active {
            transform: translateY(0);
        }

        .google-login-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .google-icon {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .features-preview {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
            text-align: left;
        }

        .features-preview h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .features-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .features-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .features-list li:last-child {
            border-bottom: none;
        }

        .feature-icon {
            color: #27ae60;
            font-weight: bold;
        }

        .public-links {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .public-links h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .public-links a {
            color: #3498db;
            text-decoration: none;
            margin: 0 15px;
            font-size: 14px;
        }

        .public-links a:hover {
            text-decoration: underline;
        }

        .loading-spinner {
            display: none;
            margin: 10px auto;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .auth-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .auth-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .auth-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .auth-status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="landing-container">
        <!-- ã‚¢ãƒ—ãƒªãƒ­ã‚´ -->
        <div class="app-logo">
            ğŸ¦·
        </div>

        <!-- ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ« -->
        <h1 class="app-title">å£è…”æ©Ÿèƒ½ä½ä¸‹ç—‡è¨ºæ–­ãƒ»ç®¡ç†ã‚¢ãƒ—ãƒª</h1>
        <p class="app-subtitle">æ—¥æœ¬è€å¹´æ­¯ç§‘åŒ»å­¦ä¼šåŸºæº–ã«åŸºã¥ãè¨ºæ–­æ”¯æ´ãƒ„ãƒ¼ãƒ«</p>

        <!-- èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="login-section">
            <button id="google-login-btn" class="google-login-btn" onclick="handleGoogleLogin()">
                <div class="google-icon">G</div>
                Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
            </button>

            <div class="loading-spinner" id="loading-spinner">
                <div class="spinner"></div>
            </div>

            <div class="auth-status" id="auth-status"></div>
        </div>

        <!-- æ©Ÿèƒ½ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
        <div class="features-preview">
            <h4>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ã”åˆ©ç”¨ã„ãŸã ã‘ã‚‹æ©Ÿèƒ½</h4>
            <ul class="features-list">
                <li><span class="feature-icon">âœ“</span> æ‚£è€…æƒ…å ±ã®å®‰å…¨ãªç®¡ç†ï¼ˆæœ€å¤§5åã¾ã§ç„¡æ–™ï¼‰</li>
                <li><span class="feature-icon">âœ“</span> å£è…”æ©Ÿèƒ½ç²¾å¯†æ¤œæŸ»ã®è¨˜éŒ²ãƒ»åˆ†æ</li>
                <li><span class="feature-icon">âœ“</span> è¨ºæ–­çµæœã®è‡ªå‹•è¨ˆç®—ã¨ç®¡ç†</li>
                <li><span class="feature-icon">âœ“</span> ç®¡ç†è¨ˆç”»æ›¸ãƒ»è¨˜éŒ²ç°¿ã®ä½œæˆ</li>
                <li><span class="feature-icon">âœ“</span> ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•åŒæœŸãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</li>
            </ul>
        </div>

        <!-- ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ -->
        <div class="public-links">
            <h4>ğŸ“‹ ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±</h4>
            <a href="about.html">ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦</a>
            <a href="privacy-policy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
            <a href="terms-of-service.html">åˆ©ç”¨è¦ç´„</a>
            <a href="contact.html">ãŠå•ã„åˆã‚ã›</a>
        </div>
    </div>

    <!-- Firebase SDKã‚’CDNã‹ã‚‰èª­ã¿è¾¼ã¿ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- Firebaseè¨­å®šã‚’èª­ã¿è¾¼ã¿ -->
    <script src="firebase-config.js"></script>
    <script src="security.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let isAuthInProgress = false;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸åˆæœŸåŒ–é–‹å§‹');
            
            // FirebaseåˆæœŸåŒ–ã‚’å¾…æ©Ÿ
            if (typeof firebaseManager !== 'undefined') {
                try {
                    const initialized = await firebaseManager.initialize();
                    if (initialized) {
                        console.log('FirebaseåˆæœŸåŒ–æˆåŠŸ');
                        setupAuthStateListener();
                        // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆçµæœã‚’ãƒã‚§ãƒƒã‚¯
                        await firebaseManager.handleRedirectResult();
                    } else {
                        console.error('FirebaseåˆæœŸåŒ–å¤±æ•—');
                        showAuthStatus('FirebaseåˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'error');
                    }
                } catch (error) {
                    console.error('FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    showAuthStatus('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                }
            } else {
                console.error('FirebaseManager ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                showAuthStatus('ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        });

        // èªè¨¼çŠ¶æ…‹ç›£è¦–ã®è¨­å®š
        function setupAuthStateListener() {
            if (firebaseManager && firebaseManager.auth) {
                firebaseManager.auth.onAuthStateChanged((user) => {
                    console.log('èªè¨¼çŠ¶æ…‹å¤‰æ›´ (ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸):', user ? 'ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿' : 'æœªãƒ­ã‚°ã‚¤ãƒ³');
                    
                    if (user && !isAuthInProgress) {
                        // èªè¨¼æ¸ˆã¿ã®å ´åˆã¯ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                        console.log('èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œå‡º - ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
                        showAuthStatus('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã«ç§»å‹•ã—ã¾ã™...', 'success');
                        
                        setTimeout(() => {
                            window.location.href = 'app.html';
                        }, 1500);
                    }
                });
            }
        }

        // Googleãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
        async function handleGoogleLogin() {
            if (isAuthInProgress) {
                console.log('èªè¨¼å‡¦ç†ä¸­ã®ãŸã‚ã€é‡è¤‡å®Ÿè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—');
                return;
            }

            const loginBtn = document.getElementById('google-login-btn');
            const loadingSpinner = document.getElementById('loading-spinner');

            try {
                isAuthInProgress = true;
                
                // UIæ›´æ–°
                loginBtn.disabled = true;
                loginBtn.innerHTML = '<div class="google-icon">G</div>èªè¨¼ä¸­...';
                loadingSpinner.style.display = 'block';
                showAuthStatus('Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼ä¸­...', 'loading');

                // Firebase Managerã®å­˜åœ¨ç¢ºèª
                if (!firebaseManager || !firebaseManager.isInitialized) {
                    throw new Error('Firebase ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }

                // Googleèªè¨¼å®Ÿè¡Œ
                console.log('Googleèªè¨¼é–‹å§‹');
                await firebaseManager.signInWithGoogle();
                
                // æˆåŠŸæ™‚ã¯onAuthStateChangedã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹

            } catch (error) {
                console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
                
                // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
                let errorMessage = 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ';
                
                if (error.message) {
                    errorMessage = error.message;
                } else if (error.code) {
                    switch (error.code) {
                        case 'auth/popup-closed-by-user':
                            errorMessage = 'ãƒ­ã‚°ã‚¤ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ';
                            break;
                        case 'auth/popup-blocked':
                            errorMessage = 'ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                            break;
                        default:
                            errorMessage = `èªè¨¼ã‚¨ãƒ©ãƒ¼: ${error.code}`;
                    }
                }
                
                showAuthStatus(errorMessage, 'error');

            } finally {
                // UIå¾©å…ƒ
                isAuthInProgress = false;
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<div class="google-icon">G</div>Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³';
                loadingSpinner.style.display = 'none';
            }
        }

        // èªè¨¼çŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showAuthStatus(message, type) {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.textContent = message;
            statusDiv.className = `auth-status ${type}`;
            statusDiv.style.display = 'block';

            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯é•·ã‚ã«è¡¨ç¤º
            const timeout = type === 'error' ? 8000 : 5000;
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, timeout);
        }

        // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
        window.debugLanding = () => {
            console.log('Landing Page Debug Info:', {
                firebaseManager: !!firebaseManager,
                isInitialized: firebaseManager ? firebaseManager.isInitialized : false,
                currentUser: firebaseManager ? firebaseManager.getCurrentUser() : null,
                isAuthInProgress
            });
        };
    </script>
</body>
</html>